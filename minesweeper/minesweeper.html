<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ‰«é›· - Brian's Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        .back-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s;
            z-index: 100;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 2rem;
            margin: 20px 0;
            text-align: center;
            background: linear-gradient(90deg, #3498db, #2980b9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-item {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .info-item span {
            color: #3498db;
            font-weight: bold;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .diff-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .diff-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-color: transparent;
        }

        .grid {
            display: inline-grid;
            gap: 2px;
            background: #1a1a2e;
            padding: 5px;
            border-radius: 10px;
            border: 2px solid #3498db;
        }

        .cell {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #4a4a6a, #3a3a5a);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.1s;
            user-select: none;
        }

        .cell:hover:not(.revealed) {
            background: linear-gradient(135deg, #5a5a7a, #4a4a6a);
        }

        .cell.revealed {
            background: rgba(255, 255, 255, 0.1);
            cursor: default;
        }

        .cell.mine {
            background: #e74c3c;
        }

        .cell.flagged::after {
            content: 'ğŸš©';
        }

        .cell.question::after {
            content: '?';
            color: #f39c12;
        }

        .cell[data-number="1"] { color: #3498db; }
        .cell[data-number="2"] { color: #2ecc71; }
        .cell[data-number="3"] { color: #e74c3c; }
        .cell[data-number="4"] { color: #9b59b6; }
        .cell[data-number="5"] { color: #e67e22; }
        .cell[data-number="6"] { color: #1abc9c; }
        .cell[data-number="7"] { color: #34495e; }
        .cell[data-number="8"] { color: #7f8c8d; }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .action-btn {
            padding: 12px 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
        }

        .mode-toggle {
            margin-top: 15px;
            text-align: center;
        }

        .mode-btn {
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.flag-mode {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: transparent;
        }

        .tip {
            color: #666;
            font-size: 0.85rem;
            margin-top: 15px;
            text-align: center;
            line-height: 1.6;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .overlay.hidden {
            display: none;
        }

        .overlay h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .overlay.win h2 { color: #2ecc71; }
        .overlay.lose h2 { color: #e74c3c; }

        .overlay p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #a0a0a0;
        }

        .overlay .time {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 30px;
        }

        @media (max-width: 500px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5rem;
                margin-top: 50px;
            }

            .game-container {
                padding: 15px;
            }

            .cell {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }

            .info-item {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">â† è¿”å›é¦–é¡µ</a>

    <h1>ğŸ’£ æ‰«é›·</h1>

    <div class="game-container">
        <div class="difficulty-selector">
            <button class="diff-btn active" onclick="setDifficulty('easy')">ç®€å• 9Ã—9</button>
            <button class="diff-btn" onclick="setDifficulty('medium')">ä¸­ç­‰ 16Ã—16</button>
            <button class="diff-btn" onclick="setDifficulty('hard')">å›°éš¾ 16Ã—30</button>
        </div>

        <div class="info-bar">
            <div class="info-item">ğŸ’£ å‰©ä½™: <span id="minesLeft">10</span></div>
            <div class="info-item">â±ï¸ æ—¶é—´: <span id="timer">0</span>ç§’</div>
            <div class="info-item">ğŸ¯ çŠ¶æ€: <span id="status">å‡†å¤‡</span></div>
        </div>

        <div class="grid" id="grid"></div>

        <div class="mode-toggle">
            <button class="mode-btn" id="modeBtn" onclick="toggleMode()">
                ğŸ” æŒ–æ˜æ¨¡å¼ (ç‚¹å‡»åˆ‡æ¢ä¸ºæ’æ——)
            </button>
        </div>

        <div class="action-buttons">
            <button class="action-btn primary" onclick="newGame()">æ–°æ¸¸æˆ</button>
        </div>

        <p class="tip">
            ğŸ’¡ ç”µè„‘: å·¦é”®æŒ–æ˜ï¼Œå³é”®æ’æ——/é—®å·<br>
            ğŸ“± æ‰‹æœº: ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ‡æ¢æ¨¡å¼
        </p>
    </div>

    <div id="overlay" class="overlay hidden">
        <h2 id="overlayTitle">æ¸¸æˆç»“æŸ</h2>
        <p id="overlayMsg">ç”¨æ—¶</p>
        <div class="time" id="finalTime">0ç§’</div>
        <button class="action-btn primary" onclick="newGame()">å†æ¥ä¸€å±€</button>
    </div>

    <script>
        const gridEl = document.getElementById('grid');
        const minesLeftEl = document.getElementById('minesLeft');
        const timerEl = document.getElementById('timer');
        const statusEl = document.getElementById('status');
        const overlay = document.getElementById('overlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const overlayMsg = document.getElementById('overlayMsg');
        const finalTimeEl = document.getElementById('finalTime');
        const modeBtn = document.getElementById('modeBtn');

        const difficulties = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 }
        };

        let currentDifficulty = 'easy';
        let rows, cols, mines;
        let grid = [];
        let revealed = [];
        let flagged = [];
        let questioned = [];
        let gameStarted = false;
        let gameOver = false;
        let timer = 0;
        let timerInterval = null;
        let flagMode = false;

        function setDifficulty(diff) {
            currentDifficulty = diff;
            document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            newGame();
        }

        function newGame() {
            const config = difficulties[currentDifficulty];
            rows = config.rows;
            cols = config.cols;
            mines = config.mines;

            grid = Array(rows).fill(null).map(() => Array(cols).fill(0));
            revealed = Array(rows).fill(null).map(() => Array(cols).fill(false));
            flagged = Array(rows).fill(null).map(() => Array(cols).fill(false));
            questioned = Array(rows).fill(null).map(() => Array(cols).fill(false));

            gameStarted = false;
            gameOver = false;
            timer = 0;
            if (timerInterval) clearInterval(timerInterval);
            timerEl.textContent = '0';
            minesLeftEl.textContent = mines;
            statusEl.textContent = 'å‡†å¤‡';
            overlay.classList.add('hidden');

            createGrid();
        }

        function createGrid() {
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${cols}, 32px)`;

            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    cell.addEventListener('click', () => handleClick(r, c));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(r, c);
                    });

                    // é•¿æŒ‰æ”¯æŒ
                    let pressTimer;
                    cell.addEventListener('touchstart', (e) => {
                        pressTimer = setTimeout(() => {
                            handleRightClick(r, c);
                        }, 500);
                    });
                    cell.addEventListener('touchend', () => {
                        clearTimeout(pressTimer);
                    });
                    cell.addEventListener('touchmove', () => {
                        clearTimeout(pressTimer);
                    });

                    gridEl.appendChild(cell);
                }
            }

            // è°ƒæ•´æ‰‹æœºç«¯æ ¼å­å¤§å°
            if (window.innerWidth < 500) {
                const cellSize = Math.min(28, Math.floor((window.innerWidth - 60) / cols));
                gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;
                gridEl.querySelectorAll('.cell').forEach(cell => {
                    cell.style.width = cellSize + 'px';
                    cell.style.height = cellSize + 'px';
                    cell.style.fontSize = (cellSize * 0.5) + 'px';
                });
            }
        }

        function placeMines(excludeR, excludeC) {
            let placed = 0;
            while (placed < mines) {
                const r = Math.floor(Math.random() * rows);
                const c = Math.floor(Math.random() * cols);

                // æ’é™¤ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®åŠå‘¨å›´
                if (Math.abs(r - excludeR) <= 1 && Math.abs(c - excludeC) <= 1) continue;
                if (grid[r][c] === -1) continue;

                grid[r][c] = -1;
                placed++;
            }

            // è®¡ç®—æ•°å­—
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (grid[r][c] === -1) continue;
                    let count = 0;
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            const nr = r + dr;
                            const nc = c + dc;
                            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && grid[nr][nc] === -1) {
                                count++;
                            }
                        }
                    }
                    grid[r][c] = count;
                }
            }
        }

        function handleClick(r, c) {
            if (gameOver) return;
            if (flagged[r][c]) return;

            if (flagMode) {
                handleRightClick(r, c);
                return;
            }

            if (!gameStarted) {
                gameStarted = true;
                placeMines(r, c);
                statusEl.textContent = 'è¿›è¡Œä¸­';
                timerInterval = setInterval(() => {
                    timer++;
                    timerEl.textContent = timer;
                }, 1000);
            }

            reveal(r, c);
        }

        function handleRightClick(r, c) {
            if (gameOver) return;
            if (revealed[r][c]) return;

            const cell = gridEl.children[r * cols + c];

            if (flagged[r][c]) {
                flagged[r][c] = false;
                questioned[r][c] = true;
                cell.classList.remove('flagged');
                cell.classList.add('question');
            } else if (questioned[r][c]) {
                questioned[r][c] = false;
                cell.classList.remove('question');
            } else {
                flagged[r][c] = true;
                cell.classList.add('flagged');
            }

            updateMinesLeft();
        }

        function reveal(r, c) {
            if (r < 0 || r >= rows || c < 0 || c >= cols) return;
            if (revealed[r][c] || flagged[r][c]) return;

            revealed[r][c] = true;
            const cell = gridEl.children[r * cols + c];
            cell.classList.add('revealed');
            cell.classList.remove('question');
            questioned[r][c] = false;

            if (grid[r][c] === -1) {
                // è¸©é›·
                cell.classList.add('mine');
                cell.textContent = 'ğŸ’£';
                endGame(false);
                return;
            }

            if (grid[r][c] > 0) {
                cell.textContent = grid[r][c];
                cell.dataset.number = grid[r][c];
            } else {
                // ç©ºæ ¼ï¼Œå±•å¼€
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        reveal(r + dr, c + dc);
                    }
                }
            }

            checkWin();
        }

        function updateMinesLeft() {
            let flagCount = 0;
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (flagged[r][c]) flagCount++;
                }
            }
            minesLeftEl.textContent = mines - flagCount;
        }

        function checkWin() {
            let revealedCount = 0;
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (revealed[r][c]) revealedCount++;
                }
            }

            if (revealedCount === rows * cols - mines) {
                endGame(true);
            }
        }

        function endGame(won) {
            gameOver = true;
            clearInterval(timerInterval);

            // æ˜¾ç¤ºæ‰€æœ‰é›·
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (grid[r][c] === -1) {
                        const cell = gridEl.children[r * cols + c];
                        if (!flagged[r][c]) {
                            cell.classList.add('revealed', 'mine');
                            cell.textContent = 'ğŸ’£';
                        }
                    }
                }
            }

            overlay.classList.remove('hidden', 'win', 'lose');
            overlay.classList.add(won ? 'win' : 'lose');
            overlayTitle.textContent = won ? 'ğŸ‰ æ­å–œè¿‡å…³!' : 'ğŸ’¥ æ¸¸æˆç»“æŸ';
            overlayMsg.textContent = won ? 'ç”¨æ—¶' : 'å¾ˆé—æ†¾ï¼Œè¸©åˆ°åœ°é›·äº†';
            finalTimeEl.textContent = timer + 'ç§’';
            statusEl.textContent = won ? 'èƒœåˆ©!' : 'å¤±è´¥';
        }

        function toggleMode() {
            flagMode = !flagMode;
            if (flagMode) {
                modeBtn.classList.add('flag-mode');
                modeBtn.textContent = 'ğŸš© æ’æ——æ¨¡å¼ (ç‚¹å‡»åˆ‡æ¢ä¸ºæŒ–æ˜)';
            } else {
                modeBtn.classList.remove('flag-mode');
                modeBtn.textContent = 'ğŸ” æŒ–æ˜æ¨¡å¼ (ç‚¹å‡»åˆ‡æ¢ä¸ºæ’æ——)';
            }
        }

        // åˆå§‹åŒ–
        newGame();
    </script>
</body>
</html>
